<!DOCTYPE html>
<html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta charset="utf-8">
<title>Redux 的简单性 - Front-End Enginnering</title>
<meta name="description" content="">
<meta name="author" content="">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1">
<link rel="stylesheet" href="../assets/css/bulma.min.css">
<link rel="stylesheet" href="../assets/css/app.css">
<!--[if lt IE 9]>
<script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
<link rel="shortcut icon" href="">
</head>
<body dir="LTR">

<nav class="columns navbar">
  <div class="column logo is-3 is-offset-1">
    <a class="is-brand" href="../index.html">
      Front-End Enginnering
    </a>
  </div>
</nav>

<div class="columns content">
  <div class="column is-2-desktop is-3-widescreen is-hidden-touch">
  </div>
  <div class="column article-container is-11-tablet is-8-desktop is-6-widescreen">
    <div class="breadcrumb-area"><a href="../index.html" class="breadcrumb-item">Home</a><span class="breadcrumb-delimiter"> &gt; </span><a href="../react/index.html" class="breadcrumb-item">React + Redux</a><span class="breadcrumb-delimiter"> &gt; </span><a href="../react/2017-09-08-the-simplicity-of-redux.html" class="breadcrumb-item">Redux 的简单性</a></div>
    <h1 class="article-title">Redux 的简单性</h1>
    
  <p>作者：张新</p>


    <div class="article">
      <p>日期：2017-09-08</p>
<p>最近关于 Redux 是什么以及如何使用 Redux 的讨论很多，过去一年半我们也在许多真实的项目中亲身实践了利用 React + Redux 来构建复杂的 SPA Web App，想谈谈我们自己的观点。</p>
<h2 id="redux-是什么">Redux 是什么 <a class="markdownIt-Anchor" href="#redux-是什么">#</a></h2>
<p>Redux 最初的源代码只有 99 行，但是它的核心却实现了一个相当简单的<strong>发布订阅模式</strong>。</p>
<blockquote>
<p>Redux会保存应用当前的状态(Store)，然后在需要的时候（通过 Dispatch）调用一个特定的 <strong>Pure</strong> 函数(Reducer)来更新该状态，并且在状态改变时通知订阅者。That's it!</p>
</blockquote>
<h2 id="redux-~-mvc">Redux ~= MVC <a class="markdownIt-Anchor" href="#redux-~-mvc">#</a></h2>
<p>在 Redux 中，我们也可以找到与<a href="http://starandtina.github.io/2015-09-06/backbone-mvc-style-guide#real-mvc">经典的 MVC</a>中相似的一些概念。</p>
<blockquote>
<p>简单来说，经典的 MVC 架构是这样工作的。首先我们会有一个 Model，它往往是整个 MVC 架构的中心。如果这个 Model 有更新了，它会通知它的观察者们某个改变发生了。然后是 View，它就是我们常常能看到的UI，并且View一般会监听着 Model。当 View 收到 Model 发来的更新通知时，View 会更新它的外观来反映Model的更新。作为用户的我们通常是与 View 交互（如点击，输入事件等等），但是呢，View 并不知道如何处理用户的交互操作。所以呢，View 会告诉 Controller 用户刚刚做了什么并且假设 Controller 知道如何处理用户的操作。Controller 这时候会更新 Model，之后不会一次一次又一次一次的重复重复再重复。另外，所有通信都是单向的。</p>
</blockquote>
<h3 id="action-controller">Action = Controller <a class="markdownIt-Anchor" href="#action-controller">#</a></h3>
<p>Action 主要描述了<strong>发生了什么</strong>（What happened）。实际开发中，我们可以把 Action 当成 Controller 来对待的。无论何时，只要你想触发一个修改（如响应 DOM 事件，异步加载数据，设置 Dropdown 组件打开状态等等），那么你就可以派发一个Action。这就像在 MVC 中，你也会交给 Controller来处理接下来的事情一样。（Controller 可能会去更新相应的 Model，从而触发重新渲染）</p>
<h3 id="reducer-~-model">Reducer ~= Model <a class="markdownIt-Anchor" href="#reducer-~-model">#</a></h3>
<p>Reducer 主要描述了<strong>如何处理这些改变</strong> (How things changed)。也就是说，Reducers 会负责管理 Web App 当前的状态（比如，用户登录信息，Domain 数据，UI 状态，App 状态等等）。当我们派发一个 Action 时，也就是交给 Reducer 来决定如何更新当前的状态。与经典的 MVC 相比，我们是交给 Model 来更新相应的状态的，比如常常会看到 Model 中会有很多叫 <code>setXXX</code> 的方法，而在 Redux 中，也会有一个相应的 Reduer 来响应这些 <code>setXXX</code>，从而更新相应的状态值。</p>
<h3 id="store">Store <a class="markdownIt-Anchor" href="#store">#</a></h3>
<p>Store 主要存储了当前 Web App 的状态。Store 是 Redux 独有的一个概念，在经典的 MVC 中，没有一个与 Store 相对应的。Redux 中的 Store 更像是一个聚集了所有分片 Reducers 的状态容器。Store 提供了一个叫<code>getState</code> 的 API 用于获取当前的状态，同时，也暴露了订阅状态更新的接口（<strong>react-redux</strong> 中 <code>connect()</code> 正是利用了这个接口来监听状态改变从而更新组件的 <code>props</code>）。Store 也会接受所有派发的 Action，同时它会将这些 Action 传递给所有的 Reducer（也许是通过 <code>combineReducers</code>），从而更新状态。Store 也支持 Middleware（中间件）函数，从而让在调用真正的 Reducer 之前实现自定义逻辑（派发 Thunks 或是 Promises），中间件函数一般是用于处理异步数据获取，日志等等功能。</p>
<h2 id="redux没有提供的">Redux没有提供的 <a class="markdownIt-Anchor" href="#redux没有提供的">#</a></h2>
<p>Redux 本身是一套用于管理状态的简单机制，核心是想让状态的改变是可预测的。可能也正是由于 Redux 看起来是如此的简单，从而才出现了围绕<em>如何使用 Redux</em> 的各种各样方法，观点，以及最佳实践。</p>
<p>正是由于 Redux 的<em>简单</em>，当我们需要构建一个大型的 Web App 时，而它却没有提供：</p>
<ul>
<li>Immutability</li>
<li>Pure functions</li>
<li>Middlewares</li>
<li>Normalization</li>
<li>Selectors</li>
<li>Thunks</li>
<li>Sagas</li>
<li>异步逻辑应该放在哪里？</li>
<li>数据是否应该范式化（normalized）或是继续保持嵌套？</li>
<li>Store中可以保存不可序列化的对象吗？如Promises或是对象实例？</li>
<li>是否应该使用 Action Creatores 来创建我们需要的Actions呢？</li>
<li>是否 Action Type 应该是<code>String</code>或是<code>Symbol</code>类型呢？是否应该使用常量来定义Action Type呢？或是直接写就好了？</li>
</ul>
<ul>
<li>为什么添加一个简单的获取列表数据功能，我们需要添加这么多文件（Constants, Actions, Reducers, Components, Containers 等等）呢？修改时也需要在这么多文件之间跳转呢</li>
<li>Redux为什么没有内置解决异步请求？这么多的异步实现方案（如 Redux Thunk, Redux Promise, Redux Saga, Redux Observable 等等），应该选择哪一个？</li>
<li>业务逻辑到底应该放在哪里呢？是在 Redux Action Creators 吗？还是在 Reducers 里？或是在 Saga 中？或是直接放在组件中</li>
<li>我应该如何组织我的项目目录结构？每个文件应该放在哪个目录下？</li>
<li>...</li>
</ul>
<h2 id="redux-设计哲学">Redux 设计哲学 <a class="markdownIt-Anchor" href="#redux-设计哲学">#</a></h2>
<p><a href="https://github.com/reactjs/redux/blob/07cf1424cb5e7bb7284acb282c996690cfc6d8c5/README.md">Redux Philosophy &amp; Design Goals</a>这是最初2015年6月Redux刚问世时，它所宣扬的设计哲学，到现在看起来时，仍然是那么的激动人心！！！</p>
<ul>
<li>You shouldn't need a book on functional programming to use Redux.</li>
<li>Everything (Stores, Action Creators, configuration) is hot reloadable.</li>
<li>Preserves the benefits of Flux, but adds other nice properties thanks to its functional nature.</li>
<li>Prevents some of the anti-patterns common in Flux code.</li>
<li>Works great in isomoprhic apps because it doesn't use singletons and the data can be rehydrated.</li>
<li>Doesn't care how you store your data: you may use JS objects, arrays, ImmutableJS, etc.</li>
<li>Under the hood, it keeps all yout data in a tree, but you don't need to think about it.</li>
<li>Lets you efficiently subscribe to finer-grained updates than individual Stores.</li>
<li>Provides hooks for powerful devtools (e.g. time travel, record/replay) to be implementable without user buy-in.</li>
<li>Provides extension points so it's easy to <a href="https://github.com/gaearon/redux/issues/99#issuecomment-112212639">support promises</a> or <a href="https://gist.github.com/skevy/8a4ffc3cfdaf5fd68739">generate constants</a> outside the core.</li>
<li>No wrapper calls in your stores and actions. Your stuff is your stuff.</li>
<li>It's super easy to test things in isolation without mocks.</li>
<li>You can use “flat” Stores, or <a href="https://gist.github.com/gaearon/d77ca812015c0356654f">compose and reuse Stores</a> just like you compose Components.</li>
<li>The API surface area is minimal.</li>
<li>Have I mentioned hot reloading yet?</li>
</ul>
<h2 id="总结">总结 <a class="markdownIt-Anchor" href="#总结">#</a></h2>
<p>Redux 内部的工作原理简单，但是根据自己项目的需求，如何正确的使用 Redux 才是真正的难题！</p>

      
    </div>
    <div  dir="ltr" class="level article-bar is-mobile">
      <div class="level-item has-text-centered">
        <a title="previous page" class="previouse-article-link" href="../react/2017-06-04-how-we-structure-react-redux-project-stucture.html"><span class="icon icon-previous" data-icon="previous"></span><span class="link-content">&laquo; Previous</span></a>
      </div>
      <div class="level-item has-text-centered">
        <a title="font size" class="link-item link-item-size">
          <span class="icon icon-size" data-icon="size"></span>
        </a>
      </div>
      <div class="level-item has-text-centered">
        <a title="table of content" class="link-item link-item-toc">
          <span class="icon icon-toc" data-icon="toc"></span>
        </a>
      </div>
      <div class="level-item has-text-centered">
        <a title="top" href="#">
          <span class="icon icon-up" data-icon="up"></span>
          <span class="link-content">⤊ Top</span>
        </a>
      </div>
      <div class="level-item has-text-centered">
        <a title="next page" class="next-article-link" href="../react/2017-09-18-how-do-we-implement-i18n-based-on-react.html"><span class="icon icon-next" data-icon="next"></span><span class="link-content">Next &raquo;</span></a>
      </div>
    </div>
  </div>
  <div class="column is-2-widescreen is-hidden">
  </div>
</div>

<div class="columns foot">
  <div class="column is-8 is-offset-1 license">
    <p>网站内容许可证：公共领域（public domain）</p>
  </div>
  <div class="column is-3 build-by">
    Build by <a href="https://github.com/ruanyf/loppo" target="_blank">Loppo</a> 0.4.4
  </div>
</div>

<div class="book-toc notification is-warning is-hidden">
  <h3>Table of chapters &nbsp;<span class="title-close"><a class="button is-danger"> Close </a></span></h3>
  <ul class="chapter-area"><li class="chapter-item "><a href="../2018-03-14-move-from-sb-to-code.html">我为什么放弃 Sublime Text 而转向 VSC？</a></li><li class="chapter-item "><a href="../2017-11-03-front-end-development-process.html">前端开发流程</a></li><li class="chapter-item "><a href="../2017-09-01-checklist-job-offer.html">工作机会的检查清单</a></li><li class="chapter-item "><a href="../active/index.html">Active</a>&nbsp;<a class="first-level-collapse"><span class="icon icon-expand" data-icon="expand"></span></a></li><ul class="chapter-level-1"><li class="chapter-item "><a href="../active/2017-09-25-active-development-workflow.html">活跃网络前端开发流程</a></li><li class="chapter-item "><a href="../active/2017-10-19-front-end-engineering-in-active.html">活跃网络的前端工程化实践之路</a></li><li class="chapter-item "><a href="../active/2017-10-23-active-china-fee-hiring-process.html">Active China Front-End Engineer Hiring Process</a></li></ul><li class="chapter-item "><a href="../life/index.html">Lift</a>&nbsp;<a class="first-level-collapse"><span class="icon icon-expand" data-icon="expand"></span></a></li><ul class="chapter-level-1"><li class="chapter-item "><a href="../life/2016-08-30-keys-to-have-health-relationship.html">作为一个开发者，如何去维系和增进健康的人际关系？</a></li><li class="chapter-item "><a href="../life/2018-03-13-maintaining-a-healthy-work-life-balance.html">如何在工作和工作中找到一个健康的平衡呢？</a></li></ul><li class="chapter-item "><a href="../react/index.html">React + Redux</a>&nbsp;<a class="first-level-collapse"><span class="icon icon-collapse" data-icon="collapse"></span></a></li><ul class="chapter-level-1 chapter-level-1-current"><li class="chapter-item "><a href="../react/2017-06-04-how-we-structure-react-redux-project-stucture.html">我们如何组织 React + Redux 项目结构</a></li><li class="chapter-item chapter-item-current"><a href="../react/2017-09-08-the-simplicity-of-redux.html">Redux 的简单性</a></li><li class="chapter-item "><a href="../react/2017-09-18-how-do-we-implement-i18n-based-on-react.html">我们如何基于 React 实现 i18n</a></li></ul></ul>
</div>

<div class="progress-indicator"></div>

<!-- SCRIPTS -->
<script>
  var LOPPO = {};
  LOPPO.current_path = 'react/2017-09-08-the-simplicity-of-redux.md';
  LOPPO.relative_root_path = '../';
  LOPPO.article_toc = "<ul class=\"markdownIt-TOC\">\n<li><a href=\"#redux-%E6%98%AF%E4%BB%80%E4%B9%88\">Redux 是什么</a></li>\n<li><a href=\"#redux-~-mvc\">Redux ~= MVC</a>\n<ul>\n<li><a href=\"#action-controller\">Action = Controller</a></li>\n<li><a href=\"#reducer-~-model\">Reducer ~= Model</a></li>\n<li><a href=\"#store\">Store</a></li>\n</ul>\n</li>\n<li><a href=\"#redux%E6%B2%A1%E6%9C%89%E6%8F%90%E4%BE%9B%E7%9A%84\">Redux没有提供的</a></li>\n<li><a href=\"#redux-%E8%AE%BE%E8%AE%A1%E5%93%B2%E5%AD%A6\">Redux 设计哲学</a></li>\n<li><a href=\"#%E6%80%BB%E7%BB%93\">总结</a></li>\n</ul>\n";
</script>
<script src="../assets/js/app.js"></script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?8abfc12836cb16954eaaccc965864e54";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>
</body>
</html>

